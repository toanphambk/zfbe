(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[378],{59326:function(e,t,r){Promise.resolve().then(r.bind(r,77944))},77944:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return HomeLayout}});var i=r(57437),a=r(61396),s=r.n(a),n=r(4202),o=r(392),l=r(14034),c=r(53415),d=r(27431),u=r(74933),sideBar=()=>{let{activeIndex:e}=(0,n.C)(e=>e.sidebarReducer);return(0,i.jsx)("div",{className:"fixed w-56 h-screen p-4",children:(0,i.jsxs)(o.Z,{className:"flex flex-col w-full h-full bg-gray-800 shadow-2xl rounded-3xl",children:[(0,i.jsxs)("div",{className:"flex flex-row items-center",children:[(0,i.jsx)(d.h4y,{className:"mr-3 text-4xl text-blue-400 "}),(0,i.jsx)(c.Z,{className:"text-lg font-semibold text-white text-md",children:"ZF System"})]}),(0,i.jsx)(l.Z,{}),u.pO.map((t,r)=>(0,i.jsxs)(s(),{href:t.link,className:"flex flex-row items-center h-12 mb-3 text-md rounded-xl \n            hover:".concat(r===e?"":"bg-gray-500","\n            ").concat(r===e?"bg-blue-400":""),children:[(0,i.jsx)(t.icon,{className:"ml-3 mr-5 text-white text-2xl"}),(0,i.jsx)(c.Z,{className:"text-lg font-semibold text-white",children:t.label})]},r))]})})},h=r(43204),f=r(10349),p=r(13664);let TopBar=()=>{var e;let t=(0,n.T)(),{activeIndex:r}=(0,n.C)(e=>e.sidebarReducer),{user:a}=(0,n.C)(e=>e.authReducer),{machine:o}=(0,n.C)(e=>e.appSettingReducer),[l]=(0,f.Pb)(),g=-1!==r?u.pO[r].label:"Unknown Page",m=u.pO[r],x=[{type:"text",title:"Code",require:!0,key:"code",focus:!0}];function getScanConfig(){let e=(0,i.jsx)(d.Xbi,{className:"mt-1 mr-5 text-3xl text-blue-600"});if(void 0===o)throw"Please setup machine";return{icon:e,title:"Scan Barcode",sucessMessage:"Sucess",errorMessage:"Fail",submitBtnColor:"blue",onSubmit:async e=>{let{formData:r}=e;try{await l({createQrCodeDto:{code:r.code,machine:o}}).unwrap()&&setTimeout(()=>{let e=getScanConfig();t((0,p.cf)((0,i.jsx)(h.Z,{...e})))},2e3)}catch(e){throw e}},fields:x}}return(0,i.jsxs)("div",{className:"flex flex-row justify-between w-full mt-2 mb-3",children:[(0,i.jsxs)("div",{className:"flex flex-col mt-3",children:[(0,i.jsxs)("div",{className:"flex flex-row",children:[(0,i.jsx)(m.icon,{className:"mr-2 text-lg font-bold text-blue-500"}),(0,i.jsx)(c.Z,{className:"font-bold text-gray-800 text-md",children:g})]}),(0,i.jsxs)("div",{className:"flex flex-row",children:[(0,i.jsxs)(c.Z,{className:"font-bold text-gray-500 text-md",children:[null==a?void 0:null===(e=a.role)||void 0===e?void 0:e.name,"/"]}),(0,i.jsx)(c.Z,{className:"font-bold text-black text-md",children:JSON.stringify(null==a?void 0:a.email)})]})]}),(0,i.jsxs)("div",{className:"flex items-center mr-5",children:[(0,i.jsxs)("div",{className:"flex flex-row items-center h-10 px-10 text-sm font-semibold text-white bg-blue-600 rounded-md shadow-sm cursor-pointer hover:bg-blue-500",onClick:()=>{let e=getScanConfig();t((0,p.cf)((0,i.jsx)(h.Z,{...e})))},children:[(0,i.jsx)(d.Xbi,{className:"text-xl "}),(0,i.jsx)("div",{children:"Scan"})]}),(0,i.jsx)(d.p0b,{className:"ml-5 text-2xl text-blue-500 hover:cursor-pointer"}),(0,i.jsx)(s(),{href:"/login",children:(0,i.jsx)(d.ApJ,{className:"ml-5 text-2xl text-blue-500 hover:cursor-pointer"})})]})]})};var g=r(24033),modal=()=>{let{isActive:e,childComponent:t}=(0,n.C)(e=>e.modalReducer);if(e)return(0,i.jsxs)("div",{className:"relative z-10",children:[(0,i.jsx)("div",{className:"fixed inset-0 transition-opacity bg-gray-500 bg-opacity-75"}),(0,i.jsx)("div",{className:"fixed inset-0 z-10 overflow-y-auto",children:(0,i.jsx)("div",{className:"flex items-center justify-center min-h-full p-4 text-center",children:t})})]})},m=r(2265),x=r(40219),v=r(40482);let SerialPortService=class SerialPortService{async openPort(){if(this.port||this.openingInProgress){console.log("Port is already open or being opened.");return}this.openingInProgress=!0;let{portInfo:e,portOption:t}=this.getPortSettings();if(!("serial"in navigator)){console.error("Web Serial API not supported.");return}if(!e||!t){console.error("Port settings are missing.");return}try{var r,i;let a=await navigator.serial.getPorts(),s=a.find(t=>t.getInfo().usbVendorId===e.usbVendorId&&t.getInfo().usbProductId===e.usbProductId);if(!s)throw Error("No matching port found");await s.open(t),this.port=s,this.dispatch((0,x.BU)({device:this.device,isOpen:!0})),this.reader=null===(r=s.readable)||void 0===r?void 0:r.getReader(),this.writer=null===(i=s.writable)||void 0===i?void 0:i.getWriter(),this.openingInProgress=!1,this.readData()}catch(e){console.error("Error opening serial port for device ".concat(this.device,":"),e),this.dispatch((0,x.sT)({device:this.device,error:e instanceof Error?e.message:String(e)})),this.openingInProgress=!1}}getPortSettings(){let e=this.getState().portsSettingReducer[this.device];if(!e)throw"No settings found for device: ".concat(this.device);return{portInfo:e.portInfo,portOption:e.portOption}}async readData(){if(!this.reader){console.error("No reader available for reading data.");return}let e="";try{for(;this.port&&this.reader;){let{value:t,done:r}=await this.reader.read();if(r){console.log("Stream closed or reader released."),this.reader.releaseLock();break}let i=new TextDecoder().decode(t);for(let t of i)if("\n"!==t&&(e+=t,"\r"===t)){let t=e.slice(0,-1);e="",this.enableDataComparison&&t===this.getState().serialPortStateReducer[this.device].data||(await this.processData(t),this.dispatch((0,x.a_)({device:this.device,data:t})))}}}catch(e){console.error("Error reading from serial port for device ".concat(this.device,":"),e),this.dispatch((0,x.sT)({device:this.device,error:e instanceof Error?e.message:String(e)}))}}async writeData(e){if(!this.writer){console.error("No writer available for sending data.");return}try{await this.writer.write(e)}catch(e){console.error("Error writing data to serial port:",e)}}async closePort(){this.reader&&(await this.reader.cancel(),this.reader.releaseLock(),this.reader=null),this.writer&&(await this.writer.close(),this.writer.releaseLock(),this.writer=null),this.port&&(await this.port.close(),this.port=null,this.dispatch((0,x.BU)({device:this.device,isOpen:!1})))}constructor(e,t,r=!0){this.device=e,this.processData=t,this.enableDataComparison=r,this.port=null,this.reader=null,this.writer=null,this.openingInProgress=!1,this.dispatch=(0,n.T)(),this.getState=()=>v.h.getState(),this.handleConnect=async e=>{console.log("Serial port connected:",e.target);let t=e.target,{portInfo:r}=this.getPortSettings();if(t.getInfo().usbVendorId===(null==r?void 0:r.usbVendorId)&&t.getInfo().usbProductId===(null==r?void 0:r.usbProductId)&&(!this.port||this.port!==t))try{await this.openPort()}catch(e){console.error("Error opening serial port:",e),this.dispatch((0,x.sT)({device:this.device,error:e instanceof Error?e.message:String(e)}))}},this.handleDisconnect=async e=>{console.log("Serial port disconnected:",e.target);let t=e.target;this.port&&t===this.port&&(this.port=null,this.writer=null,this.reader=null,this.dispatch((0,x.BU)({device:this.device,isOpen:!1})))},navigator.serial.addEventListener("connect",this.handleConnect),navigator.serial.addEventListener("disconnect",this.handleDisconnect)}};var b=r(86248),S=r(12541);function HomeLayout(e){let{children:t}=e,r=(0,g.useRouter)(),[a]=(0,f.bF)(),[s]=(0,f.Pb)(),{isError:o,isSuccess:l}=(0,f.h3)(void 0,{refetchOnMountOrArgChange:!0}),c=(0,n.T)(),d=(0,g.usePathname)(),{machine:h}=(0,n.C)(e=>e.appSettingReducer),{rfid:x,scanner:v}=(0,n.C)(e=>e.portsSettingReducer),sendRfidData=async e=>{if(void 0===h){c((0,p.cf)((0,i.jsx)(b.Z,{type:"error",title:"Error",message:"Please setup machine"})));return}try{await a({createRfidDto:{code:e,machine:h}})}catch(e){console.error("Error sending rfid data:",e)}},sendScannerData=async e=>{if(void 0===h){c((0,p.cf)((0,i.jsx)(b.Z,{type:"error",title:"Error",message:"Please setup machine"})));return}try{await s({createQrCodeDto:{code:e,machine:h}})}catch(e){console.error("Error sending rfid data:",e)}},[w]=(0,m.useState)(()=>new SerialPortService("rfid",sendRfidData,!0)),[P]=(0,m.useState)(()=>new SerialPortService("scanner",sendScannerData,!1));return((0,m.useEffect)(()=>{w.openPort()},[x,w]),(0,m.useEffect)(()=>{P.openPort()},[v,P]),(0,m.useEffect)(()=>{c((0,u.N7)(d))},[d,c]),o)?(r.push("/login"),null):l?(0,i.jsxs)(S.Z,{className:"flex h-full min-w-full min-h-screen bg-gray-300",children:[(0,i.jsx)(modal,{}),(0,i.jsx)(sideBar,{}),(0,i.jsxs)("div",{className:"flex flex-col w-full pl-56 pr-4",children:[(0,i.jsx)(TopBar,{}),(0,i.jsx)("div",{className:"flex flex-wrap w-full",children:t})]})]}):null}},63899:function(e,t,r){"use strict";r.d(t,{$k:function(){return d},um:function(){return c}});var i=r(24302),a=r(10349);let s=(0,i.createSlice)({name:"auth",initialState:{isLoading:!1,isError:null,email:"",password:""},reducers:{SetEmail:(e,t)=>{e.email=t.payload},SetPassword:(e,t)=>{e.password=t.payload},LoginStart:e=>{e.isLoading=!0,e.isError=null},LoginSuccess:e=>{e.isLoading=!1,e.isError=null},LoginFailure:(e,t)=>{e.isLoading=!1,e.isError=t.payload.data}},extraReducers:e=>{e.addMatcher(a.hi.endpoints.authControllerAdminLogin.matchFulfilled,e=>{s.caseReducers.LoginSuccess(e)}).addMatcher(a.hi.endpoints.authControllerAdminLogin.matchPending,e=>{s.caseReducers.LoginStart(e)}).addMatcher(a.hi.endpoints.authControllerAdminLogin.matchRejected,(e,t)=>{s.caseReducers.LoginFailure(e,t)})}}),{LoginStart:n,LoginSuccess:o,LoginFailure:l,SetEmail:c,SetPassword:d}=s.actions;t.ZP=s.reducer},74933:function(e,t,r){"use strict";r.d(t,{N7:function(){return o},pO:function(){return n}});var i=r(24302),a=r(27431);let s=(0,i.createSlice)({name:"sidebar",initialState:{activeIndex:0},reducers:{SetSidebarActiveIndex:(e,t)=>{e.activeIndex=n.findIndex(e=>e.link==t.payload)}}}),n=[{icon:a.g3P,label:"Home",link:"/home"},{icon:a.HuB,label:"Report",link:"/home/report"},{icon:a.__X,label:"Setting",link:"/home/setting"},{icon:a._K$,label:"Profile",link:"/home/profile"},{icon:a.ApJ,label:"Logout",link:"/login"}],{SetSidebarActiveIndex:o}=s.actions;t.ZP=s.reducer},26915:function(e,t,r){"use strict";r.d(t,{x:function(){return s}});var i=r(24302);let a=(0,i.createSlice)({name:"appSetting",initialState:{machine:void 0},reducers:{setAppSettingMachine:(e,t)=>{e.machine=t.payload}}}),{setAppSettingMachine:s}=a.actions;t.Z=a.reducer},52556:function(e,t,r){"use strict";r.d(t,{G:function(){return l}});var i=r(24302),a=r(10349);let s={token:void 0,user:void 0},n=(0,i.createSlice)({name:"auth",initialState:s,reducers:{setAuthData:(e,t)=>{let{token:r,user:i}=t.payload;e.token=r||e.token,e.user=i||e.user},removeAuthData:()=>s},extraReducers:e=>{e.addMatcher(a.hi.endpoints.authControllerAdminLogin.matchFulfilled,(e,t)=>{n.caseReducers.setAuthData(e,t)}),e.addMatcher(a.hi.endpoints.authControllerAdminLogin.matchRejected,e=>{n.caseReducers.removeAuthData()})}}),{setAuthData:o,removeAuthData:l}=n.actions;t.ZP=n.reducer},36804:function(e,t,r){"use strict";r.d(t,{OL:function(){return n},b2:function(){return o}});var i=r(24302);let a={rfid:{},scanner:{}},s=(0,i.createSlice)({name:"portsSetting",initialState:a,reducers:{setPortInfo:(e,t)=>{let{device:r,portInfo:i}=t.payload;e[r].portInfo=i},setPortOption:(e,t)=>{let{device:r,portOption:i}=t.payload;e[r].portOption=i},removeSerialSetting:()=>a}}),{setPortInfo:n,setPortOption:o,removeSerialSetting:l}=s.actions;t.ZP=s.reducer},40219:function(e,t,r){"use strict";r.d(t,{BU:function(){return s},a_:function(){return n},sT:function(){return o}});var i=r(24302);let a=(0,i.createSlice)({name:"serialPortState",initialState:{rfid:{isOpen:!1,data:"",error:null},scanner:{isOpen:!1,data:"",error:null}},reducers:{setOpenState:(e,t)=>{let{device:r,isOpen:i}=t.payload;e[r].isOpen=i},setData:(e,t)=>{let{device:r,data:i}=t.payload;console.log(i),e[r].data=i},setError:(e,t)=>{let{device:r,error:i}=t.payload;e[r].error=i}}}),{setOpenState:s,setData:n,setError:o}=a.actions;t.ZP=a.reducer},40482:function(e,t,r){"use strict";r.d(t,{D:function(){return j},h:function(){return y}});var i=r(24302),a=r(81267),s=r(11850),n=r(52967),o=r(75793),l=r(74933),c=r(63899),d=r(13664);let u={selectedMachine:void 0},h=(0,i.createSlice)({name:"settingPage",initialState:u,reducers:{removeModal:()=>u,setSelectedMachine:(e,t)=>{let{id:r}=t.payload;e.selectedMachine=t.payload}}}),{setSelectedMachine:f}=h.actions;var p=h.reducer,g=r(52556),m=r(36804),x=r(40219),v=r(26915),b=r(10349);let S=(0,o.UY)({[b.hi.reducerPath]:b.hi.reducer,settingPageReducer:p,sidebarReducer:l.ZP,authReducer:g.ZP,loginReducer:c.ZP,modalReducer:d.ZP,portsSettingReducer:m.ZP,serialPortStateReducer:x.ZP,appSettingReducer:v.Z}),w={key:"root",storage:s.Z,blacklist:[b.hi.reducerPath,"modalReducer","settingPageReducer","serialPortStateReducer"]},P=(0,a.OJ)(w,S),y=(0,i.configureStore)({reducer:P,devTools:!1,middleware:e=>e({serializableCheck:{ignoredActions:[a._P,a.I2,a.E7,a.ex,a.e,a.Nz,"modal/setModal"],ignoredPaths:["modalReducer.childComponent"]}}).concat(b.hi.middleware)});(0,n.sj)(y.dispatch);let j=(0,a.p5)(y)}},function(e){e.O(0,[982,792,254,543,286,306,225,507,971,472,744],function(){return e(e.s=59326)}),_N_E=e.O()}]);