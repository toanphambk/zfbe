(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[951],{23769:function(e,t,r){"use strict";r.d(t,{Dx:function(){return l.Z},Zb:function(){return o.Z},zx:function(){return a.Z}});var a=r(6020),o=r(392),l=r(82630)},8650:function(e,t,r){Promise.resolve().then(r.bind(r,1402))},1402:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return page}});var a=r(57437),o=r(2265),l=r(4202),n=r(90189),i=r(392),c=r(7821);let s=[{color:"rose",tooltip:"Downtime"},{color:"emerald",tooltip:"Operational"},{color:"emerald",tooltip:"Operational"},{color:"emerald",tooltip:"Operational"},{color:"emerald",tooltip:"Operational"},{color:"emerald",tooltip:"Operational"},{color:"emerald",tooltip:"Operational"},{color:"emerald",tooltip:"Operational"},{color:"emerald",tooltip:"Operational"},{color:"emerald",tooltip:"Operational"},{color:"emerald",tooltip:"Operational"},{color:"emerald",tooltip:"Operational"},{color:"emerald",tooltip:"Operational"},{color:"emerald",tooltip:"Operational"},{color:"emerald",tooltip:"Operational"},{color:"rose",tooltip:"Downtime"},{color:"gray",tooltip:"no data"},{color:"gray",tooltip:"no data"},{color:"gray",tooltip:"no data"},{color:"gray",tooltip:"no data"},{color:"gray",tooltip:"no data"},{color:"gray",tooltip:"no data"},{color:"gray",tooltip:"no data"},{color:"gray",tooltip:"no data"},{color:"gray",tooltip:"no data"}];var upTimeCard=()=>((0,l.T)(),(0,a.jsxs)(i.Z,{className:"flex flex-col w-full h-40",children:[(0,a.jsxs)("div",{className:"flex flex-row justify-between mt-1",children:[(0,a.jsx)("text",{className:"text-xl font-semibold text-black ",children:"Up Time"}),(0,a.jsx)(n.Z,{size:"md",color:"green",children:"92 %"})]}),(0,a.jsx)("div",{className:"flex justify-between mt-1",children:(0,a.jsx)("text",{className:"font-medium text-gray-500 text-start",children:"May 2022 - Ship 1"})}),(0,a.jsx)(c.Z,{data:s,className:"mt-4"})]})),d=r(73407),u=r(30705),shiftTargetCard=()=>((0,l.T)(),(0,a.jsxs)(i.Z,{className:"flex flex-col w-full h-40",children:[(0,a.jsxs)("div",{className:"flex flex-row justify-between font-medium text-gray-500 ",children:[(0,a.jsx)("text",{className:"text-xl font-semibold text-black ",children:"Shift Target"}),(0,a.jsxs)(n.Z,{size:"md",color:"green",children:[Math.floor(33.33333333333333)," %"]})]}),(0,a.jsx)(d.Z,{values:[50,20,80],showLabels:!0,colors:["green","red","gray"],className:"w-full mt-4"}),(0,a.jsx)(u.Z,{className:"mt-2 ",categories:["Good","NoGood","Remain"],colors:["emerald","red","gray"]})]})),m=r(10349),h=r(12348),machineInfoCard=()=>{(0,l.T)();let{machine:e}=(0,l.C)(e=>e.appSettingReducer),{refetch:t,data:r}=(0,m.mN)({machineId:e?e.id:0},{skip:void 0===e,refetchOnMountOrArgChange:!0});return((0,o.useEffect)(()=>{let r=setInterval(async()=>{e&&await t().unwrap()},5e3);return()=>clearInterval(r)},[h.machine]),r)?(0,a.jsxs)(i.Z,{className:"flex flex-col w-full h-40",children:[(0,a.jsxs)("div",{className:"flex flex-row justify-between ",children:[(0,a.jsx)("div",{className:"text-xl font-semibold text-black ",children:"Line Info"}),(0,a.jsx)(n.Z,{size:"md",className:"font-semibold",color:r.connection?"green":"red",children:r.connection?"Connected":"Disconnected"})]}),(0,a.jsxs)("div",{className:"flex flex-col items-start w-full",children:[(0,a.jsxs)("div",{className:"flex justify-between w-full mt-2",children:[(0,a.jsx)("div",{className:"text-base font-semibold text-gray-500",children:"State"}),(0,a.jsx)(n.Z,{size:"md",className:"font-semibold",color:"green",children:r.state})]}),(0,a.jsxs)("div",{className:"flex justify-between w-full mt-2",children:[(0,a.jsx)("div",{className:"text-base font-semibold text-gray-500",children:"IP"}),(0,a.jsx)(n.Z,{size:"md",className:"font-semibold",children:r.config.machine.ip})]}),(0,a.jsxs)("div",{className:"flex justify-between w-full mt-2",children:[(0,a.jsx)("div",{className:"text-base font-semibold text-gray-500",children:"ID"}),(0,a.jsx)(n.Z,{size:"md",className:"font-semibold",children:r.config.machine.systemID})]})]})]}):(0,a.jsx)(i.Z,{className:"flex flex-col w-full h-40",children:"Loading..."})},f=r(5512),x=r(82630);let getCurrrentDateTime=()=>{let e=new Date;return e.toISOString()};var shiftLineChart=()=>{(0,l.T)();let{machine:e}=(0,l.C)(e=>e.appSettingReducer),[t,r]=(0,o.useState)(()=>getCurrrentDateTime()),{refetch:n,data:c}=(0,m.$I)({machineId:e?e.id:0,time:t},{skip:void 0===e,refetchOnMountOrArgChange:!0,refetchOnReconnect:!0});return(0,o.useEffect)(()=>{let e=setInterval(()=>{r(getCurrrentDateTime()),n().unwrap()},6e4);return()=>clearInterval(e)},[]),(0,a.jsxs)(i.Z,{className:"flex flex-col w-full mt-4",children:[(0,a.jsx)(x.Z,{children:"Product Count"}),(0,a.jsx)(f.Z,{className:"h-64 mt-6 ",data:c||[],index:"Hour",categories:["Actual"],colors:["emerald","gray"],yAxisWidth:40})]})},p=r(86248),y=r(13664),D=r(23769),g=r(62074),C=r.n(g),v=r(96769),b=r(27431);let shiftRecordTable_getCurrrentDateTime=()=>{let e=new Date;return e.setHours(0,0,0,0),e.toISOString()};var shiftRecordTable=()=>{let e=(0,l.T)(),[t,r]=(0,o.useState)(()=>shiftRecordTable_getCurrrentDateTime()),{machine:n}=(0,l.C)(e=>e.appSettingReducer);(0,o.useEffect)(()=>{let e=setInterval(()=>{r(shiftRecordTable_getCurrrentDateTime()),i().unwrap()},5e3);return()=>clearInterval(e)},[]);let{refetch:i,data:c}=(0,m.dz)({machineId:n?n.id:0,startTime:t},{skip:void 0===n,refetchOnMountOrArgChange:!0,refetchOnReconnect:!0}),s=[{name:"Module Serial No.",selector:e=>e.moduleSerialNo},{name:"PLC Date Time",selector:e=>e.systemDt},{name:"Created At",selector:e=>{let t=new Date(e.createdAt);return t.toString()},sortable:!0,customSort:(e,t,r)=>[...e].sort((e,a)=>{let o=t(e),l=t(a);return"string"==typeof o?"desc"===r?l.localeCompare(o):o.localeCompare(l):"number"==typeof o?"desc"===r?l-o:o-l:o instanceof Date?"desc"===r?l.getTime()-o.getTime():o.getTime()-l.getTime():"desc"===r?l.toString().localeCompare(o.toString()):o.toString().localeCompare(l.toString())})},{name:"Good/NG",right:!0,selector:e=>e.result,cell:e=>{var t,r;return(0,a.jsx)("div",{className:"text-center py-2 px-4 rounded ".concat(1===e.result?"bg-green-500 text-white":2===e.result?"bg-red-500 text-white":"bg-yellow-500 text-white"),children:(null===(t=e.result)||void 0===t?void 0:t.toString())==="1"?"Good":(null===(r=e.result)||void 0===r?void 0:r.toString())==="2"?"NG":"Unknown"})}}],onReloadClickHandler=async()=>{try{await i().unwrap()}catch(r){let t={type:"error",title:"Error",message:"Load Record Error",data:JSON.stringify(r,null,2)};e((0,y.cf)((0,a.jsx)(p.Z,{...t})))}},dataToCsv=e=>{let t="data:text/csv;charset=utf-8,";return t+="Module Serial No,System Date,Result,Created At,OPID,CurDta_QD01,CurDta_QD02,CurDta_QD03,CurDta_QD04,PrvDta1_QD01,PrvDta1_QD02,PrvDta1_QD03,PrvDta1_QD04,PrvDta2_QD01,PrvDta2_QD02,PrvDta2_QD03,PrvDta2_QD04,Try Count,RT,OType,QD01 Min,QD01 Max,QD02 Min,QD02 Max,QD03 Min,QD03 Max,QD04 Min,QD04 Max,Operator Name,OP Text\r\n",e.forEach(e=>{e.recordDatas.forEach(r=>{let a="".concat(e.moduleSerialNo,",").concat(e.systemDt,",").concat(e.result,",").concat(e.createdAt,",").concat(r.OPID,",").concat(r.CurDta_QD01,",").concat(r.CurDta_QD02,",").concat(r.CurDta_QD03,",").concat(r.CurDta_QD04,",").concat(r.PrvDta1_QD01,",").concat(r.PrvDta1_QD02,",").concat(r.PrvDta1_QD03,",").concat(r.PrvDta1_QD04,",").concat(r.PrvDta2_QD01,",").concat(r.PrvDta2_QD02,",").concat(r.PrvDta2_QD03,",").concat(r.PrvDta2_QD04,",").concat(r.TryCnt,",").concat(r.RT,",").concat(r.OType,",").concat(r.QD01_Min,",").concat(r.QD01_Max,",").concat(r.QD02_Min,",").concat(r.QD02_Max,",").concat(r.QD03_Min,",").concat(r.QD03_Max,",").concat(r.QD04_Min,",").concat(r.QD04_Max,",").concat(r.OperatorName.replace(/,/g,";"),",").concat(r.OPTxt.replace(/,/g,";"));t+=a+"\r\n"})}),t},generateXmlForRecord=e=>{console.log(e);let{recordDatas:t,systemDt:r,moduleSerialNo:a}=e,{systemID:o,lineID:l,stationID:n,stationName:i}=e.machine,c={lineInfo:{SystemID:o,SystemDT:r,ModuleSerialNo:a},stationInfo:{LineID:l,StationName:i,StationID:n,PartID:"0",Mode:"0"}},s="".concat(i,"_").concat(a,"_").concat(r,".xml"),d="<Data\n";return d+=formatDataForXml("QD.HDR",c.lineInfo)+"\n"+formatDataForXml("QD.HDR",c.stationInfo)+' DBType="QUALITY"\n',t.forEach(async(e,t)=>{d+=formatDataForXml("QD.DT0".concat(t+1),e)+"\n"}),{fileName:s,xmlData:d+="/>"}},downloadXmlAsZip=async e=>{let r=new(C()),a=document.createElement("a");e.forEach(e=>{let{fileName:t,xmlData:a}=generateXmlForRecord(e);r.file(t,a)});let o=await r.generateAsync({type:"blob"}),l=new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"2-digit",day:"numeric"}),i=window.URL.createObjectURL(o),c="".concat(null==n?void 0:n.systemID,"_").concat(l.replace(/[-:]/g,""),".zip");a.href=i,a.download=c,document.body.appendChild(a),a.click(),window.URL.revokeObjectURL(i),a.remove()},formatDataForXml=(e,t)=>Object.entries(t).map(t=>{let[r,a]=t;return"".concat(e,".").concat(r.replace("_","."),'="').concat(a,'"')}).join(" "),downloadCSV=e=>{let r=document.createElement("a"),a=dataToCsv(e),o=new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"2-digit",day:"numeric"}),l="".concat(null==n?void 0:n.systemID,"_").concat(o.replace(/[-:]/g,""),".csv");a.match(/^data:text\/csv/i)||(a="data:text/csv;charset=utf-8,".concat(a)),r.setAttribute("href",encodeURI(a)),r.setAttribute("download",l),r.click()};return(0,a.jsxs)(D.Zb,{className:"flex flex-col w-full my-4",children:[(0,a.jsxs)("div",{className:"flex flex-row justify-between w-full",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(D.Dx,{children:"Record Table"}),(0,a.jsx)(b.lgS,{type:"button",onClick:onReloadClickHandler,className:"p-1 mx-5 text-2xl font-bold text-white bg-blue-900 rounded-full hover:cursor-pointer hover:bg-blue-700 "})]}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(D.zx,{className:"mr-5",onClick:e=>downloadCSV(c||[]),children:"Export CSV"}),(0,a.jsx)(D.zx,{className:"mr-5",onClick:e=>downloadXmlAsZip(c||[]),children:"Export Xml"})]})]}),(0,a.jsx)(v.ZP,{className:"font-semibold",columns:s,data:c||[],pagination:!0,onRowClicked:t=>{e((0,y.cf)((0,a.jsx)(p.Z,{type:"info",title:"Record data",data:JSON.stringify(t.recordDatas,null,2),message:"Record Of Module Serial No".concat(t.moduleSerialNo," ")})))},customStyles:{rows:{style:{"&:hover":{backgroundColor:"#f7fafc"}}}},paginationPerPage:10,paginationRowsPerPageOptions:[10,25,50,100],paginationComponentOptions:{rowsPerPageText:"Rows per page:",rangeSeparatorText:"of"}})]})},page=()=>(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex flex-row w-full",children:[(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsx)(machineInfoCard,{})}),(0,a.jsx)("div",{className:"flex-1 px-4",children:(0,a.jsx)(shiftTargetCard,{})}),(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsx)(upTimeCard,{})})]}),(0,a.jsx)("div",{className:"flex flex-row w-full",children:(0,a.jsx)("div",{className:"flex w-full",children:(0,a.jsx)(shiftLineChart,{})})}),(0,a.jsx)("div",{className:"flex flex-row w-full",children:(0,a.jsx)(shiftRecordTable,{})})]})},86248:function(e,t,r){"use strict";var a=r(57437),o=r(13664),l=r(4202),n=r(2265),i=r(27431);t.Z=e=>{let{type:t,message:r,data:c,title:s,onClose:d}=e,u=(0,l.T)(),removeModalHandler=()=>{null==d||d(),u((0,o.a_)())},{icon:m,childComponent:h}=(0,n.useMemo)(()=>{switch(t){case"success":return{icon:(0,a.jsx)(i.HJi,{className:"mx-2 mt-1 text-2xl text-blue-500"})};case"info":return{icon:(0,a.jsx)(i.frK,{className:"mx-2 text-3xl text-blue-500"}),childComponent:(0,a.jsx)("div",{className:"flex flex-row items-center px-4 py-4 mx-5 mt-4 bg-gray-800 rounded-lg",children:(0,a.jsx)("pre",{className:"font-mono text-sm text-left text-white max-h-96 overflow-auto hide-scrollbar",children:c})})};default:return{icon:(0,a.jsx)(i.VLi,{className:"mx-2 text-3xl text-red-500"}),childComponent:(0,a.jsx)("div",{className:"flex flex-row items-center px-5 py-4 mx-5 mt-4 bg-gray-800 rounded-lg",children:(0,a.jsx)("pre",{className:"font-mono text-sm text-left text-white",children:c})})}}},[t,c]);return(0,a.jsxs)("form",{className:"flex flex-col text-black bg-white shadow-xl rounded-xl",onKeyDown:e=>{"Escape"===e.key&&removeModalHandler()},children:[(0,a.jsxs)("div",{className:"flex flex-row items-center justify-center mt-8",children:[m,(0,a.jsx)("div",{className:"text-2xl font-semibold text-black",children:s})]}),(0,a.jsx)("div",{className:"flex flex-row items-center justify-center mx-20 mt-6",children:(0,a.jsx)("div",{className:"font-semibold text-black text-md",children:r})}),h,(0,a.jsx)("div",{className:"flex flex-row-reverse items-center px-6 py-3 mt-5 bg-gray-100 rounded-xl",children:(0,a.jsx)("button",{type:"button",className:"w-20 h-10 ml-2 text-sm font-semibold text-gray-900 bg-white rounded-md shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50",onClick:removeModalHandler,children:"Cancel"})})]})}},13664:function(e,t,r){"use strict";r.d(t,{a_:function(){return i},cf:function(){return n}});var a=r(24302);let o={isActive:!1,childComponent:null},l=(0,a.createSlice)({name:"modal",initialState:o,reducers:{removeModal:()=>o,setModal:(e,t)=>{e.childComponent=t.payload,e.isActive=!0}}}),{setModal:n,removeModal:i}=l.actions;t.ZP=l.reducer},4202:function(e,t,r){"use strict";r.d(t,{C:function(){return o},T:function(){return useAppDispatch}});var a=r(81023);let useAppDispatch=()=>(0,a.I0)(),o=a.v9},10349:function(e,t,r){"use strict";r.d(t,{hi:function(){return i},Cd:function(){return p},h3:function(){return v},Pb:function(){return M},bF:function(){return E},HJ:function(){return N},ed:function(){return T},uU:function(){return P},Xv:function(){return O},dz:function(){return L},$I:function(){return Z},mN:function(){return U},Y0:function(){return q},aG:function(){return Q},c5:function(){return I},UU:function(){return R}});var a=r(38324),o=r(6349);let l=(0,o.fetchBaseQuery)({baseUrl:"/",prepareHeaders:(e,t)=>{let{getState:r}=t,a=r().authReducer.token;return a&&e.set("authorization","Bearer ".concat(a)),e}}),n=(0,a.LC)({baseQuery:l,endpoints:()=>({})}),i=n.injectEndpoints({endpoints:e=>({usersControllerCreate:e.mutation({query:e=>({url:"/api/users",method:"POST",body:e.createUserDto})}),usersControllerFindAll:e.query({query:e=>({url:"/api/users",params:{page:e.page,limit:e.limit}})}),usersControllerFindOne:e.query({query:e=>({url:"/api/users/".concat(e.id)})}),usersControllerUpdate:e.mutation({query:e=>({url:"/api/users/".concat(e.id),method:"PATCH",body:e.updateUserDto})}),usersControllerRemove:e.mutation({query:e=>({url:"/api/users/".concat(e.id),method:"DELETE"})}),filesControllerUploadFile:e.mutation({query:e=>({url:"/api/files/upload",method:"POST",body:e.body})}),filesControllerDownload:e.query({query:e=>({url:"/api/files/".concat(e.path)})}),authControllerLogin:e.mutation({query:e=>({url:"/api/auth/email/login",method:"POST",body:e.authEmailLoginDto})}),authControllerAdminLogin:e.mutation({query:e=>({url:"/api/auth/admin/email/login",method:"POST",body:e.authEmailLoginDto})}),authControllerRegister:e.mutation({query:e=>({url:"/api/auth/email/register",method:"POST",body:e.authRegisterLoginDto})}),authControllerConfirmEmail:e.mutation({query:e=>({url:"/api/auth/email/confirm",method:"POST",body:e.authConfirmEmailDto})}),authControllerForgotPassword:e.mutation({query:e=>({url:"/api/auth/forgot/password",method:"POST",body:e.authForgotPasswordDto})}),authControllerResetPassword:e.mutation({query:e=>({url:"/api/auth/reset/password",method:"POST",body:e.authResetPasswordDto})}),authControllerMe:e.query({query:()=>({url:"/api/auth/me"})}),authControllerUpdate:e.mutation({query:e=>({url:"/api/auth/me",method:"PATCH",body:e.authUpdateDto})}),authControllerDelete:e.mutation({query:()=>({url:"/api/auth/me",method:"DELETE"})}),homeControllerAppInfo:e.query({query:()=>({url:"/"})}),machineControllerCreate:e.mutation({query:e=>({url:"/api/machine",method:"POST",body:e.createMachineDto})}),machineControllerFindAll:e.query({query:()=>({url:"/api/machine"})}),machineControllerFindOne:e.query({query:e=>({url:"/api/machine/".concat(e.id)})}),machineControllerUpdate:e.mutation({query:e=>({url:"/api/machine/".concat(e.id),method:"PATCH",body:e.updateMachineDto})}),machineControllerRemove:e.mutation({query:e=>({url:"/api/machine/".concat(e.id),method:"DELETE"})}),shiftControllerCreate:e.mutation({query:e=>({url:"/api/shift",method:"POST",body:e.createShiftDto})}),shiftControllerFindAll:e.query({query:e=>({url:"/api/shift",params:{id:e.id}})}),shiftControllerFindOne:e.query({query:e=>({url:"/api/shift/".concat(e.id)})}),shiftControllerUpdate:e.mutation({query:e=>({url:"/api/shift/".concat(e.id),method:"PATCH",body:e.updateShiftDto})}),shiftControllerRemove:e.mutation({query:e=>({url:"/api/shift/".concat(e.id),method:"DELETE"})}),hardwareActionControllerCreateQrCode:e.mutation({query:e=>({url:"/api/qrCode/createQrCode",method:"POST",body:e.createQrCodeDto})}),hardwareActionControllerCreateRfid:e.mutation({query:e=>({url:"/api/qrCode/createRFID",method:"POST",body:e.createRfidDto})}),mesControllerFindAllRecord:e.query({query:()=>({url:"/api/mes"})}),mesControllerFindAllRecordByMachineAndDateTime:e.query({query:e=>({url:"/api/mes/machineDateTime",params:{machineId:e.machineId,startTime:e.startTime,endTime:e.endTime}})}),mesControllerGetDailyLineChartData:e.query({query:e=>({url:"/api/mes/dailyLineChartData",params:{machineId:e.machineId,time:e.time}})}),mesControllerFindOneRecord:e.query({query:e=>({url:"/api/mes/".concat(e.moduleSerialNo)})}),monitorServiceManagerControllerGetMachineState:e.query({query:e=>({url:"/api/monitor",params:{machineId:e.machineId}})})}),overrideExisting:!1}),{useUsersControllerCreateMutation:c,useUsersControllerFindAllQuery:s,useUsersControllerFindOneQuery:d,useUsersControllerUpdateMutation:u,useUsersControllerRemoveMutation:m,useFilesControllerUploadFileMutation:h,useFilesControllerDownloadQuery:f,useAuthControllerLoginMutation:x,useAuthControllerAdminLoginMutation:p,useAuthControllerRegisterMutation:y,useAuthControllerConfirmEmailMutation:D,useAuthControllerForgotPasswordMutation:g,useAuthControllerResetPasswordMutation:C,useAuthControllerMeQuery:v,useAuthControllerUpdateMutation:b,useAuthControllerDeleteMutation:w,useHomeControllerAppInfoQuery:j,useMachineControllerCreateMutation:N,useMachineControllerFindAllQuery:T,useMachineControllerFindOneQuery:S,useMachineControllerUpdateMutation:O,useMachineControllerRemoveMutation:P,useShiftControllerCreateMutation:q,useShiftControllerFindAllQuery:Q,useShiftControllerFindOneQuery:_,useShiftControllerUpdateMutation:R,useShiftControllerRemoveMutation:I,useHardwareActionControllerCreateQrCodeMutation:M,useHardwareActionControllerCreateRfidMutation:E,useMesControllerFindAllRecordQuery:A,useMesControllerFindAllRecordByMachineAndDateTimeQuery:L,useMesControllerGetDailyLineChartDataQuery:Z,useMesControllerFindOneRecordQuery:k,useMonitorServiceManagerControllerGetMachineStateQuery:U}=i}},function(e){e.O(0,[982,792,254,826,20,74,270,971,472,744],function(){return e(e.s=8650)}),_N_E=e.O()}]);